;7seg
;active low
;p2.0 ~ p2.3

;a=p0.0 ~ g=p0.6 logic 0 = turn ON segmen

SEGMNT1 EQU 69H
SEGMNT2 EQU 68H
SEGMNT3 EQU 67H
SEGMNT4 EQU 66H
NUM1    EQU 65H
NUM2    EQU 64H
NUM3    EQU 63H
NUM4    EQU 62H	

SEGM   EQU 52H
T1H    EQU 0EDH  ;0EDA8H is 5ms interval
T1L    EQU 0A8H
org 0000h

ljmp main

ORG 001BH
	
LJMP ISR_T1
	
org 0100h

main:
mov sp,#30h
mov p2,#0ffh
MOV SEGM,#1

MOV TMOD,#10H
MOV TL1,#T1L
MOV TH1,#T1H
MOV IE,#88H
MOV NUM1,#0
MOV NUM2,#0
MOV NUM3,#0
MOV NUM4,#0
CALL DISPLAY
SETB TR1

start:
MOV NUM2,#6
MOV NUM3,#5
CALL DISPLAY
SJMP $




sjmp start

DISPLAY:
MOV DPTR,#SEGMENTS
MOV A,NUM1
MOVC A,@A+DPTR
MOV SEGMNT1,A
MOV A,NUM2
MOVC A,@A+DPTR
MOV SEGMNT2,A
MOV A,NUM3
MOVC A,@A+DPTR
MOV SEGMNT3,A
MOV A,NUM4
MOVC A,@A+DPTR
MOV SEGMNT4,A

RET

ISR_T1:
MOV A,SEGM

CJNE A,#1,SEG2
SETB P2.1
SETB P2.3
mov p0,SEGMNT1;#11111001b
clr p2.0
INC A
MOV SEGM,A
SJMP EXIT_INT

SEG2:
CJNE A,#2,SEG3
setb p2.0
mov p0,SEGMNT2;#10100100b;#11111001b
clr p2.1
INC A
MOV SEGM,A
SJMP EXIT_INT

SEG3:
CJNE A,#3,SEG4
setb p2.1
mov p0,SEGMNT3;#10110000b
clr p2.2
INC A
MOV SEGM,A
SJMP EXIT_INT

SEG4:
CJNE A,#4,EXIT_INT
setb p2.2
mov p0,SEGMNT4 ;#10011001b
clr p2.3
INC A
MOV SEGM,A
SJMP EXIT_INT

EXIT_INT:
CJNE A,#5,EX_INT
MOV SEGM,#1
EX_INT:

MOV TL1,#T1L
MOV TH1,#T1H
SETB TR1
RETI


jmp main

;========


;===========  
segments:
db 11000000b
db 11111001b
db 10100100b
db 10110000b
db 10011001b
db 10010010b
db 10000010b
db 11111000b
db 10000000b
db 10010000b


END